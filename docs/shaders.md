
# Shaders

## Functions

* [attach-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#attach-shader): Attaches a shader object to a program object.
* [compile-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#compile-shader): Compiles a shader object.
* [create-program](https://hectarea1996.github.io/cl-opengl/shaders.html#create-program): Creates a program object.
* [create-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#create-shader): Creates a shader object.
* [delete-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#delete-shader): Deletes a shader object.
* [link-program](https://hectarea1996.github.io/cl-opengl/shaders.html#link-program): Links a program object.
* [shader-source](https://hectarea1996.github.io/cl-opengl/shaders.html#create-shader): Replaces the source code in a shader object.
* [use-program]((https://hectarea1996.github.io/cl-opengl/shaders.html#use-program): Installs a program object as part of current rendering state.

## Function documentation

### attach-shader

```
(attach-shader program shader)
```

In order to create a complete shader program, there must be a way to specify the list of things that will be linked together. Program objects provide this mechanism. Shaders that are to be linked together in a program object must first be attached to that program object. `attach-shader` attaches the shader object specified by *shader* to the program object specified by *program*. This indicates that *shader* will be included in link operations that will be performed on *program*.

All operations that can be performed on a shader object are valid whether or not the shader object is attached to a program object. It is permissible to attach a shader object to a program object before source code has been loaded into the shader object or before the shader object has been compiled. It is permissible to attach multiple shader objects of the same type because each may contain a portion of the complete shader. It is also permissible to attach a shader object to more than one program object. If a shader object is deleted while it is attached to a program object, it will be flagged for deletion, and deletion will not occur until [detach-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#detach-shader) is called to detach it from all program objects to which it is attached.

* **Parameters**:
  * **program**: Specifies the program object to which a shader object will be attached.
  * **shader**: Specifies the shader object that is to be attached.

* **Errors**:
  * `:invalid-value` is generated if either program or shader is not a value generated by OpenGL.
  * `:invalid-operation` is generated if *program* is not a program object.
  * `:invalid-operation` is generated if *shader* is not a shader object.
  * `:invalid-operation` is generated if *shader* is already attached to *program*.

* **Associated gets**:
  * [get-attached-shaders](https://hectarea1996.github.io/cl-opengl/shaders.html#get-attached-shaders) with the handle of a valid program object.
  * [get-shader-info-log](https://hectarea1996.github.io/cl-opengl/shaders.html#get-shader-info-log).
  * [get-shader-source](https://hectarea1996.github.io/cl-opengl/shaders.html#get-shader-source).
  * [is-program](https://hectarea1996.github.io/cl-opengl/shaders.html#is-program).
  * [is-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#is-shader).

### compile-shader

```
(compile-shader shader)
```

`compile-shader` compiles the source code strings that have been stored in the shader object specified by *shader*.

The compilation status will be stored as part of the shader object's state. This value will be set to `:true` if the shader was compiled without errors and is ready for use, and `:false` otherwise. It can be queried by calling [get-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#get-shader) with arguments *shader* and `:compile-status`.

Compilation of a shader can fail for a number of reasons as specified by the OpenGL Shading Language Specification. Whether or not the compilation was successful, information about the compilation can be obtained from the shader object's information log by calling [get-shader-info-log](https://hectarea1996.github.io/cl-opengl/shaders.html#get-shader-info-log).

* **Parameters**:
  * **shader**: Specifies the shader object to be compiled.

* **Errors**:
  * `:invalid-value` is generated if *shader* is not a value generated by OpenGL.
  * `:invalid-operation` is generated if *shader* is not a shader object.

* **Associated gets**:
  * [get-shader-info-log](https://hectarea1996.github.io/cl-opengl/shaders.html#get-shader-info-log) with argument *shader*.
  * [get-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#get-shader) with arguments *shader* and `:compile-status`.

### create-program

```
(create-program) => program
```

`create-program` creates an empty program object and returns a non-zero value by which it can be referenced. A program object is an object to which shader objects can be attached. This provides a mechanism to specify the shader objects that will be linked to create a program. It also provides a means for checking the compatibility of the shaders that will be used to create a program (for instance, checking the compatibility between a vertex shader and a fragment shader). When no longer needed as part of a program object, shader objects can be detached.

One or more executables are created in a program object by successfully attaching shader objects to it with [attach-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#attach-shader), successfully compiling the shader objects with [compile-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#compile-shader), and successfully linking the program object with [link-program](https://hectarea1996.github.io/cl-opengl/shaders.html#link-program). These executables are made part of current state when [use-program](https://hectarea1996.github.io/cl-opengl/shaders.html#use-program) is called. Program objects can be deleted by calling [delete-program](https://hectarea1996.github.io/cl-opengl/shaders.html#delete-program). The memory associated with the program object will be deleted when it is no longer part of current rendering state for any context.

* **Notes**:
  * Like buffer and texture objects, the name space for program objects may be shared across a set of contexts, as long as the server sides of the contexts share the same address space. If the name space is shared across contexts, any attached objects and the data associated with those attached objects are shared as well.
  * Applications are responsible for providing the synchronization across API calls when objects are accessed from different execution threads.

* **Errors**:
  * This function returns 0 if an error occurs creating the program object.

* **Associated gets**:
  * [get](https://hectarea1996.github.io/cl-opengl/state-management.html#get) with the argument `:current-program`.
  * [get-active-attrib](https://hectarea1996.github.io/cl-opengl/shaders.html#get-active-attrib) with a valid program object and the index of an active attribute variable.
  * [get-active-uniform](https://hectarea1996.github.io/cl-opengl/shaders.html#get-active-uniform) with a valid program object and the index of an active uniform variable.
  * [get-attached-shaders](https://hectarea1996.github.io/cl-opengl/shaders.html#get-attached-shaders) with a valid program object.
  * [get-attrib-location](https://hectarea1996.github.io/cl-opengl/shaders.html#get-attrib-location) with a valid program object and the name of an attribute variable.
  * [get-program](https://hectarea1996.github.io/cl-opengl/shaders.html#get-program) with a valid program object and the parameter to be queried.
  * [get-program-info-log](https://hectarea1996.github.io/cl-opengl/shaders.html#get-program-info-log) with a valid program object.
  * [get-uniform](https://hectarea1996.github.io/cl-opengl/shaders.html#get-uniform) with a valid program object and the location of a uniform variable.
  * [get-uniform-location](https://hectarea1996.github.io/cl-opengl/shaders.html#get-uniform-location) with a valid program object and the name of a uniform variable.
  * [is-program](https://hectarea1996.github.io/cl-opengl/shaders.html#is-program).

### create-shader

```
(create-shader shaderType) => shader
```

`create-shader` creates an empty shader object and returns a non-zero value by which it can be referenced. A shader object is used to maintain the source code strings that define a shader. *shaderType* indicates the type of shader to be created. Five types of shader are supported. A shader of type `:compute-shader` is a shader that is intended to run on the programmable compute processor. A shader of type `:vertex-shader` is a shader that is intended to run on the programmable vertex processor. A shader of type `:tess-control-shader` is a shader that is intended to run on the programmable tessellation processor in the control stage. A shader of type `:tess-evaluation-shader` is a shader that is intended to run on the programmable tessellation processor in the evaluation stage. A shader of type `:geometry-shader` is a shader that is intended to run on the programmable geometry processor. A shader of type `:fragment-shader` is a shader that is intended to run on the programmable fragment processor.

When created, a shader object's `:shader-type` parameter is set to either `:compute-shader`, `:vertex-shader`, `:tess-control-shader`, `:tess-evaluation-shader`, `:geometry-shader` or `:fragment-shader`, depending on the value of *shaderType*.

* **Parameters**:
  * **shaderType**: Specifies the type of shader to be created. Must be one of `:compute-shader`, `:vertex-shader`, `:tess-control-shader`, `:tess-evaluation-shader`, `:geometry-shader` or `:fragment-shader`.

* **Notes**:
  * Like buffer and texture objects, the name space for shader objects may be shared across a set of contexts, as long as the server sides of the contexts share the same address space. If the name space is shared across contexts, any attached objects and the data associated with those attached objects are shared as well.
  * Applications are responsible for providing the synchronization across API calls when objects are accessed from different execution threads.

* **Errors**:
  * This function returns 0 if an error occurs creating the shader object.
  * `:invalid-enum` is generated if *shaderType* is not an accepted value.

* **Associated gets**:
  * [get-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#get-shader) with a valid shader object and the parameter to be queried.
  * [get-shader-info-log](https://hectarea1996.github.io/cl-opengl/shaders.html#get-shader-info-log) with a valid shader object.
  * [get-shader-source](https://hectarea1996.github.io/cl-opengl/shaders.html#get-shader-source) with a valid shader object.
  * [is-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#is-shader).

### delete-shader

```
(delete-shader shader)
```

`delete-shader` frees the memory and invalidates the name associated with the shader object specified by *shader*. This command effectively undoes the effects of a call to [create-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#create-shader).

If a shader object to be deleted is attached to a program object, it will be flagged for deletion, but it will not be deleted until it is no longer attached to any program object, for any rendering context (i.e., it must be detached from wherever it was attached before it will be deleted). A value of 0 for *shader* will be silently ignored.

To determine whether an object has been flagged for deletion, call [get-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#get-shader) with arguments shader and `:delete-status`.

* **Parameters**:
  * **shader**: Specifies the shader object to be deleted.

* **Errors**:
  * `:invalid-value` is generated if *shader* is not a value generated by OpenGL.

* **Associated gets**:
  * [get-attached-shaders](https://hectarea1996.github.io/cl-opengl/shaders.html#get-attached-shaders) with the program object to be queried.
  * [get-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#get-shader) with arguments *shader* and `:delete-status`.
  * [is-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#is-shader).

### link-program

```
(link-program program)
```

`link-program` links the program object specified by *program*. If any shader objects of type `:vertex-shader` are attached to *program*, they will be used to create an executable that will run on the programmable vertex processor. If any shader objects of type `:geometry-shader` are attached to *program*, they will be used to create an executable that will run on the programmable geometry processor. If any shader objects of type `:fragment-shader` are attached to *program*, they will be used to create an executable that will run on the programmable fragment processor.

The status of the link operation will be stored as part of the program object's state. This value will be set to `:true` if the program object was linked without errors and is ready for use, and `:false` otherwise. It can be queried by calling [get-program](https://hectarea1996.github.io/cl-opengl/shaders.html#get-program) with arguments *program* and `:link-status`.

As a result of a successful link operation, all active user-defined uniform variables belonging to *program* will be initialized to 0, and each of the program object's active uniform variables will be assigned a location that can be queried by calling [get-uniform-location](https://hectarea1996.github.io/cl-opengl/shaders.html#get-uniform-location). Also, any active user-defined attribute variables that have not been bound to a generic vertex attribute index will be bound to one at this time.

Linking of a program object can fail for a number of reasons as specified in the *OpenGL Shading Language Specification*. The following lists some of the conditions that will cause a link error.

* The number of active attribute variables supported by the implementation has been exceeded.
* The storage limit for uniform variables has been exceeded.
* The number of active uniform variables supported by the implementation has been exceeded.
* The `main` function is missing for the vertex, geometry or fragment shader.
* A varying variable actually used in the fragment shader is not declared in the same way (or is not declared at all) in the vertex shader, or geometry shader shader if present.
* A reference to a function or variable name is unresolved.
* A shared global is declared with two different types or two different initial values.
* One or more of the attached shader objects has not been successfully compiled.
* Binding a generic attribute matrix caused some rows of the matrix to fall outside the allowed maximum of `:max-vertex-attribs`.
* Not enough contiguous vertex attribute slots could be found to bind attribute matrices.
* The program object contains objects to form a fragment shader but does not contain objects to form a vertex shader.
* The program object contains objects to form a geometry shader but does not contain objects to form a vertex shader.
* The program object contains objects to form a geometry shader and the input primitive type, output primitive type, or maximum output vertex count is not specified in any compiled geometry shader object.
* The program object contains objects to form a geometry shader and the input primitive type, output primitive type, or maximum output vertex count is specified differently in multiple geometry shader objects.
* The number of active outputs in the fragment shader is greater than the value of `:max-draw-buffers`.
* The program has an active output assigned to a location greater than or equal to the value of `:max-dual-source-draw-buffers` and has an active output assigned an index greater than or equal to one.
* More than one varying out variable is bound to the same number and index.
* The explicit binding assigments do not leave enough space for the linker to automatically assign a location for a varying out array, which requires multiple contiguous locations.
* The count specified by [transform-feedback-varyings](https://hectarea1996.github.io/cl-opengl/transform-feedback.html#transform-feedback-varyings) is non-zero, but the program object has no vertex or geometry shader.
* Any variable name specified to [transform-feedback-varyings](https://hectarea1996.github.io/cl-opengl/transform-feedback.html#transform-feedback-varyings) in the *varyings* array is not declared as an output in the vertex shader (or the geometry shader, if active).
* Any two entries in the *varyings* array given [transform-feedback-varyings](https://hectarea1996.github.io/cl-opengl/transform-feedback.html#transform-feedback-varyings) specify the same varying variable.
* The total number of components to capture in any transform feedback varying variable is greater than the constant `:max-transform-feedback-separate-components` and the buffer mode is `:separate-attribs`.

When a program object has been successfully linked, the program object can be made part of current state by calling [use-program](https://hectarea1996.github.io/cl-opengl/shaders.html#use-program). Whether or not the link operation was successful, the program object's information log will be overwritten. The information log can be retrieved by calling [get-program-info-log](https://hectarea1996.github.io/cl-opengl/shaders.html#get-program-info-log).

`link-program` will also install the generated executables as part of the current rendering state if the link operation was successful and the specified program object is already currently in use as a result of a previous call to [use-program](https://hectarea1996.github.io/cl-opengl/shaders.html#use-program). If the program object currently in use is relinked unsuccessfully, its link status will be set to `:false` , but the executables and associated state will remain part of the current state until a subsequent call to `use-program` removes it from use. After it is removed from use, it cannot be made part of current state until it has been successfully relinked.

If *program* contains shader objects of type `:vertex-shader`, and optionally of type `:geometry-shader`, but does not contain shader objects of type `:fragment-shader`, the vertex shader executable will be installed on the programmable vertex processor, the geometry shader executable, if present, will be installed on the programmable geometry processor, but no executable will be installed on the fragment processor. The results of rasterizing primitives with such a program will be undefined.

The program object's information log is updated and the program is generated at the time of the link operation. After the link operation, applications are free to modify attached shader objects, compile attached shader objects, detach shader objects, delete shader objects, and attach additional shader objects. None of these operations affects the information log or the program that is part of the program object.

* **Parameters**:
  * **program**: Specifies the handle of the program object to be linked.

* **Notes**:
  * If the link operation is unsuccessful, any information about a previous link operation on *program* is lost (i.e., a failed link does not restore the old state of *program* ). Certain information can still be retrieved from *program* even after an unsuccessful link operation. See for instance [get-active-attrib](https://hectarea1996.github.io/cl-opengl/shaders.html#get-active-attrib) and [get-active-uniform](https://hectarea1996.github.io/cl-opengl/shaders.html#get-active-uniform).

* **Errors**:
  * `:invalid-value` is generated if *program* is not a value generated by OpenGL.
  * `:invalid-operation` is generated if *program* is not a program object.
  * `:invalid-operation` is generated if *program* is the currently active program object and transform feedback mode is active.

* **Associated gets**:
  * [get](https://hectarea1996.github.io/cl-opengl/state-management.html#get) with the argument `:current-program`.
  * [get-active-attrib](https://hectarea1996.github.io/cl-opengl/shaders.html#get-active-attrib) with a valid program object and the index of an active attribute variable.
  * [get-active-uniform](https://hectarea1996.github.io/cl-opengl/shaders.html#get-active-uniform) with a valid program object and the index of an active uniform variable.
  * [get-attached-shaders](https://hectarea1996.github.io/cl-opengl/shaders.html#get-attached-shaders) with a valid program object.
  * [get-attrib-location](https://hectarea1996.github.io/cl-opengl/shaders.html#get-attrib-location) with a valid program object and an attribute variable name.
  * [get-program](https://hectarea1996.github.io/cl-opengl/shaders.html#get-program) with arguments *program* and `:link-status`.
  * [get-program-info-log](https://hectarea1996.github.io/cl-opengl/shaders.html#get-program-info-log) with argument *program*.
  * [get-uniform](https://hectarea1996.github.io/cl-opengl/shaders.html#get-uniform) with argument *program* and a uniform variable location.
  * [get-uniform-location](https://hectarea1996.github.io/cl-opengl/shaders.html#get-uniform-location) with argument *program* and a uniform variable name.
  * [is-program](https://hectarea1996.github.io/cl-opengl/shaders.html#is-program).

### shader-source

```
(shader-source shader list-string)
```

`shader-source` sets the source code in *shader* to the source code in the array of strings specified by *list-string*. Any source code previously stored in the shader object is completely replaced. The source code strings are not scanned or parsed at this time; they are simply copied into the specified shader object.

* **Parameters**:
  * **shader**: Specifies the handle of the shader object whose source code is to be replaced.
  * **list-string**: Specifies a list of strings containing the source code to be loaded into the shader.

* **Errors**:
  * `:invalid-value` is generated if *shader* is not a value generated by OpenGL.
  * `:invalid-operation` is generated if shader is not a shader object.

* **Associated gets**:
  * [get-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#get-shader) with arguments *shader* and `:shader-source-length`.
  * [get-shader-source](https://hectarea1996.github.io/cl-opengl/shaders.html#get-shader-source) with argument *shader*.
  * [is-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#is-shader).

### use-program

```
(use-program program)
```

`use-program` installs the program object specified by *program* as part of current rendering state. One or more executables are created in a program object by successfully attaching shader objects to it with [attach-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#attach-shader), successfully compiling the shader objects with [compile-shader](https://hectarea1996.github.io/cl-opengl/shaders.html#compile-shader), and successfully linking the program object with [link-program](https://hectarea1996.github.io/cl-opengl/shaders.html#link-program).

A program object will contain an executable that will run on the vertex processor if it contains one or more shader objects of type `:vertex-shader` that have been successfully compiled and linked. A program object will contain an executable that will run on the geometry processor if it contains one or more shader objects of type `:geometry-shader` that have been successfully compiled and linked. Similarly, a program object will contain an executable that will run on the fragment processor if it contains one or more shader objects of type `:fragment-shader` that have been successfully compiled and linked.

While a program object is in use, applications are free to modify attached shader objects, compile attached shader objects, attach additional shader objects, and detach or delete shader objects. None of these operations will affect the executables that are part of the current state. However, relinking the program object that is currently in use will install the program object as part of the current rendering state if the link operation was successful (see [link-program](https://hectarea1996.github.io/cl-opengl/shaders.html#link-program)). If the program object currently in use is relinked unsuccessfully, its link status will be set to `:false`, but the executables and associated state will remain part of the current state until a subsequent call to `use-program` removes it from use. After it is removed from use, it cannot be made part of current state until it has been successfully relinked.

If *program* is zero, then the current rendering state refers to an *invalid* program object and the results of shader execution are undefined. However, this is not an error.

If *program* does not contain shader objects of type `:fragment-shader`, an executable will be installed on the vertex, and possibly geometry processors, but the results of fragment shader execution will be undefined.

* **Parameters**:
  * **program**: Specifies the handle of the program object whose executables are to be used as part of current rendering state.

* **Notes**:
  * Like buffer and texture objects, the name space for program objects may be shared across a set of contexts, as long as the server sides of the contexts share the same address space. If the name space is shared across contexts, any attached objects and the data associated with those attached objects are shared as well.
  * Applications are responsible for providing the synchronization across API calls when objects are accessed from different execution threads.

* **Errors**:
  * `:invalid-value` is generated if program is neither 0 nor a value generated by OpenGL.
  * `:invalid-operation` is generated if program is not a program object.
  * `:invalid-operation` is generated if program could not be made part of current state.
  * `:invalid-operation` is generated if transform feedback mode is active.

* **Associated gets**:
  * [get](https://hectarea1996.github.io/cl-opengl/state-management.html#get) with the argument `:current-program`.
  * [get-active-attrib](https://hectarea1996.github.io/cl-opengl/shaders.html#get-active-attrib) with a valid program object and the index of an active attribute variable
  * [get-active-uniform](https://hectarea1996.github.io/cl-opengl/shaders.html#get-active-uniform) with a valid program object and the index of an active uniform variable.
  * [get-attached-shaders](https://hectarea1996.github.io/cl-opengl/shaders.html#get-attached-shaders) with a valid program object.
  * [get-attrib-location](https://hectarea1996.github.io/cl-opengl/shaders.html#get-attrib-location) with a valid program object and the name of an attribute variable.
  * [get-program](https://hectarea1996.github.io/cl-opengl/shaders.html#get-program) with a valid program object and the parameter to be queried.
  * [get-program-info-log](https://hectarea1996.github.io/cl-opengl/shaders.html#get-program-info-log) with a valid program object.
  * [get-uniform](https://hectarea1996.github.io/cl-opengl/shaders.html#get-uniform) with a valid program object and the location of a uniform variable.
  * [get-uniform-location](https://hectarea1996.github.io/cl-opengl/shaders.html#get-uniform-location) with a valid program object and the name of a uniform variable.
  * [is-program](https://hectarea1996.github.io/cl-opengl/shaders.html#is-program).
